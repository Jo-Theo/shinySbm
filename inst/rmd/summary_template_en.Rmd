---
title: "Shiny SBM Report"
params:
  upload: NA
  sbm: NA
  options: NA
  langue: EN

output:
  pdf_doxument:
    latex_engine: xelatex
  
---

```{r function, include = F}
nb_digits <- 2

round_prop <- function(x,digits = 2){
  prop_vec <- round(x,digits)
  prop_vec[length(prop_vec)] <- 1 - sum(prop_vec[1:(length(prop_vec)-1)])
  return(prop_vec)
}

smalltable <- function(data, header = F, rownames = F, title = NULL,nb_digits = 2){
  flextable::set_flextable_defaults(digits = nb_digits)
  fp_cap <- flextable::fp_text_default(bold = T)
  tbl <- flextable::as_flextable(data,show_coltype = F)
  if(!header){
    tbl <- flextable::delete_part(tbl, part = "header")
  }
  if(!is.null(title)){
    tbl <- flextable::set_caption(tbl,caption = title,fp_p = fp_cap)
  }
  if(rownames){
     tbl <- flextable::void(tbl,j = 1, part = "header")
  }
  tbl <- flextable::border_inner(tbl) %>%
    flextable::border_outer()
  return(tbl)
}
```


```{r setup, echo=FALSE}
options(digits = nb_digits)

library(shinySbm)

R <- purrr::map(params,~if(identical(.x,"NA")){NA}else{.x})
show_mat <- !identical(R$upload,NA)
show_sbm <- !identical(R$sbm,NA)

if(!identical(R$options,NA)){
  is_transposed <- R$options$showTransposed
}else{
  is_transposed <- F
}
if(show_mat){
  is_bipartite <- R$upload$Dataset$type == 'bipartite'
}else{
  is_bipartite <- F
}
```

```{r child1, child=if(!show_mat & !show_sbm) 'child_empty_en.Rmd'}
```


```{r, echo=FALSE, results = 'asis'}

if(show_mat){
  
  cat("## Introduction\nThis automatic report was produced by the [Shiny SBM](https://forgemia.inra.fr/theodore.vanrenterghem/shinySbm) application (also available via this [link](https://shiny.migale.inrae.fr/app/ShinySBM)). It is an application summary of a stochastic block model. The modeling part is based on the R package [sbm](https://CRAN.R-project.org/package=sbm).")
  
  imported_text <- knitr::knit_child('child_imported_en.Rmd', quiet = TRUE)
  cat(imported_text, sep = '\n')
  
  cat("## Visuel de Matrice")
  
  imported_vis <- knitr::knit_child('child_imported_visual.Rmd', quiet = TRUE)
  cat(imported_vis, sep = '\n')
  
  cat(ifelse(is_transposed,"Note that in this image, columns and rows are reversed.",""))
  
}

```


```{r, echo=FALSE, results = 'asis'}

if(show_sbm){
  
  cat("## Results of the stochastic block model",sep = "")
  
  sbm_text <- knitr::knit_child('child_sbm_en.Rmd', quiet = TRUE)
  cat(sbm_text, sep = '\n')
  
  cat("## SBM visualization")
  
  sbm_vis <- knitr::knit_child('child_sbm_visual.Rmd', quiet = TRUE)
  cat(sbm_vis, sep = '\n')
  
  cat(ifelse(is_transposed,"Note that in this image, columns and rows are reversed.",""))
  
}

```



# References

1.  Chiquet J, Donnet S, Barbillon P (2023).  sbm: Stochastic Blockmodels. R package version 0.4.5,  
  [https://CRAN.R-project.org/package=sbm](https://CRAN.R-project.org/package=sbm).
  
2.  Vanrenterghem T, Julie A (2023).  ShinySBM: A shiny application for Stochastic Blockmodels. R package on gitlab,  
  [https://forgemia.inra.fr/theodore.vanrenterghem/shinySbm](https://forgemia.inra.fr/theodore.vanrenterghem/shinySbm).
  
3.  We are grateful to the INRAE MIGALE bioinformatics facility (MIGALE, INRAE, 2020. Migale bioinformatics Facility, doi:
  10.15454/1.5572390655343293E12) for providing help and/or computing and/or storage resources.
  




